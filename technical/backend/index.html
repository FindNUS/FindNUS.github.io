<!doctype html><html lang=en class=color-toggle-hidden><head><meta charset=utf-8><meta name=referrer content="no-referrer"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=generator content="Hugo 0.101.0"><meta name=description content="Table of contents Key Technologies High-Level Overview Integration Details Recieving HTTP requests from frontend Sending messages between microservices Ensuring Thread-safe communication Creating, removing and updating, deleting Items Image storage with Imgur Synchronising the Search Engine Smart Lookout Service :star: Examples Appendix A: Backend Design Choices Architecture: Microservice Platform: Heroku Additional Considerations Database: MongoDB Message Broker: RabbitMQ Search Engine: Elasticsearch Language: Golang Image storage: Imgur In this page, we document:"><title>Backend Technical Documentation | FindNUS Documentation</title><link rel=icon type=image/svg+xml href=/favicon/favicon.png><link rel=icon type=image/png sizes=32x32 href=/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon/favicon-16x16.png><meta property="og:title" content="Backend Technical Documentation"><meta property="og:site_name" content="FindNUS Documentation"><meta property="og:description" content="Table of contents Key Technologies High-Level Overview Integration Details Recieving HTTP requests from frontend Sending messages between microservices Ensuring Thread-safe communication Creating, removing and updating, deleting Items Image storage with Imgur Synchronising the Search Engine Smart Lookout Service :star: Examples Appendix A: Backend Design Choices Architecture: Microservice Platform: Heroku Additional Considerations Database: MongoDB Message Broker: RabbitMQ Search Engine: Elasticsearch Language: Golang Image storage: Imgur In this page, we document:"><meta property="og:type" content="article"><meta property="og:url" content="https://FindNUS.github.io/technical/backend/"><meta property="article:section" content="Technical"><meta name=twitter:card content="summary"><meta name=twitter:title content="Backend Technical Documentation"><meta name=twitter:description content="Table of contents Key Technologies High-Level Overview Integration Details Recieving HTTP requests from frontend Sending messages between microservices Ensuring Thread-safe communication Creating, removing and updating, deleting Items Image storage with Imgur Synchronising the Search Engine Smart Lookout Service :star: Examples Appendix A: Backend Design Choices Architecture: Microservice Platform: Heroku Additional Considerations Database: MongoDB Message Broker: RabbitMQ Search Engine: Elasticsearch Language: Golang Image storage: Imgur In this page, we document:"><script type=application/ld+json>{"@context":"http://schema.org","@type":"TechArticle","articleSection":"Technical","name":"Backend Technical Documentation","url":"https://FindNUS.github.io/technical/backend/","headline":"Backend Technical Documentation","description":"Table of contents Key Technologies High-Level Overview Integration Details Recieving HTTP requests from frontend Sending messages between microservices Ensuring Thread-safe communication Creating, removing and updating, deleting Items Image storage with Imgur Synchronising the Search Engine Smart Lookout Service :star: Examples Appendix A: Backend Design Choices Architecture: Microservice Platform: Heroku Additional Considerations Database: MongoDB Message Broker: RabbitMQ Search Engine: Elasticsearch Language: Golang Image storage: Imgur In this page, we document:","wordCount":"3660","license":"CC BY-SA 4.0","inLanguage":"en","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https://FindNUS.github.io/technical/backend/"},"copyrightHolder":"FindNUS Documentation","copyrightYear":"0001","dateCreated":"0001-01-01T00:00:00.00Z","datePublished":"0001-01-01T00:00:00.00Z","dateModified":"0001-01-01T00:00:00.00Z","publisher":{"@type":"Organization","name":"FindNUS Documentation","url":"https://FindNUS.github.io/","logo":{"@type":"ImageObject","url":"https://FindNUS.github.io/brand.svg","width":"32","height":"32"}}}</script><script src=/js/main-51ef884d.bundle.min.js></script>
<link rel=preload as=font href=/fonts/Metropolis.woff2 type=font/woff2 crossorigin=anonymous><link rel=preload as=font href=/fonts/LiberationSans.woff2 type=font/woff2 crossorigin=anonymous><link rel=preload href=/main-33f7b719.min.css as=style><link rel=stylesheet href=/main-33f7b719.min.css media=all><link rel=preload href=/mobile-467819cb.min.css as=style><link rel=stylesheet href=/mobile-467819cb.min.css media="screen and (max-width: 45rem)"><link rel=preload href=/print-19966b38.min.css as=style><link rel=stylesheet href=/print-19966b38.min.css media=print><link rel=preload href=/custom.css as=style><link rel=stylesheet href=/custom.css media=all><link href=https://FindNUS.github.io/technical/backend/ rel=canonical type=text/html></head><body itemscope itemtype=https://schema.org/WebPage><svg class="svg-sprite" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><svg viewBox="-7.27 -7.27 38.55 38.55" id="gdoc_arrow_back" xmlns="http://www.w3.org/2000/svg"><path d="M24 10.526v2.947H5.755l8.351 8.421-2.105 2.105-12-12 12-12 2.105 2.105-8.351 8.421H24z"/></svg><svg viewBox="-7.27 -7.27 38.55 38.55" id="gdoc_arrow_left_alt" xmlns="http://www.w3.org/2000/svg"><path d="M5.965 10.526V6.035L0 12l5.965 5.965v-4.491H24v-2.947H5.965z"/></svg><svg viewBox="-7.27 -7.27 38.55 38.55" id="gdoc_arrow_right_alt" xmlns="http://www.w3.org/2000/svg"><path d="M18.035 10.526V6.035L24 12l-5.965 5.965v-4.491H0v-2.947h18.035z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_bitbucket" xmlns="http://www.w3.org/2000/svg"><path d="M15.905 13.355c.189 1.444-1.564 2.578-2.784 1.839-1.375-.602-1.375-2.784-.034-3.403 1.151-.705 2.818.223 2.818 1.564zm1.907-.361c-.309-2.44-3.076-4.056-5.328-3.042-1.426.636-2.389 2.148-2.32 3.747.086 2.097 2.08 3.815 4.176 3.626s3.729-2.234 3.472-4.331zm4.108-9.315c-.756-.997-2.045-1.169-3.179-1.358-3.214-.516-6.513-.533-9.727.034-1.066.172-2.269.361-2.939 1.323 1.1 1.031 2.664 1.186 4.073 1.358 2.544.327 5.156.344 7.699.017 1.426-.172 3.008-.309 4.073-1.375zm.979 17.788c-.481 1.684-.206 3.953-1.994 4.932-3.076 1.701-6.806 1.89-10.191 1.289-1.787-.327-3.884-.894-4.864-2.578-.43-1.65-.705-3.334-.98-5.018l.103-.275.309-.155c5.121 3.386 12.288 3.386 17.427.0.808.241.206 1.22.189 1.805zM26.01 4.951c-.584 3.764-1.255 7.51-1.908 11.257-.189 1.1-1.255 1.719-2.148 2.183-3.214 1.615-6.96 1.89-10.483 1.512-2.389-.258-4.829-.894-6.771-2.389-.911-.705-.911-1.908-1.083-2.922-.602-3.523-1.289-7.046-1.719-10.604.206-1.547 1.942-2.217 3.231-2.698C6.848.654 8.686.362 10.508.19c3.884-.378 7.854-.241 11.618.859 1.341.395 2.784.945 3.695 2.097.412.533.275 1.203.189 1.805z"/></svg><svg viewBox="-7.27 -7.27 38.55 38.55" id="gdoc_bookmark" xmlns="http://www.w3.org/2000/svg"><path d="M15.268 4.392q.868.0 1.532.638t.664 1.506v17.463l-7.659-3.268-7.608 3.268V6.536q0-.868.664-1.506t1.532-.638h10.876zm4.34 14.144V4.392q0-.868-.638-1.532t-1.506-.664H6.537q0-.868.664-1.532T8.733.0h10.876q.868.0 1.532.664t.664 1.532v17.412z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_brightness_auto" xmlns="http://www.w3.org/2000/svg"><path d="M16.846 18.938h2.382L15.22 7.785h-2.44L8.772 18.938h2.382l.871-2.44h3.95zm7.087-9.062L27.999 14l-4.066 4.124v5.809h-5.809L14 27.999l-4.124-4.066H4.067v-5.809L.001 14l4.066-4.124V4.067h5.809L14 .001l4.124 4.066h5.809v5.809zm-11.385 4.937L14 10.282l1.452 4.531h-2.904z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_brightness_dark" xmlns="http://www.w3.org/2000/svg"><path d="M14 21.435q3.079.0 5.257-2.178T21.435 14t-2.178-5.257T14 6.565q-1.51.0-3.079.697 1.917.871 3.108 2.701T15.22 14t-1.191 4.037-3.108 2.701q1.568.697 3.079.697zm9.933-11.559L27.999 14l-4.066 4.124v5.809h-5.809L14 27.999l-4.124-4.066H4.067v-5.809L.001 14l4.066-4.124V4.067h5.809L14 .001l4.124 4.066h5.809v5.809z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_brightness_light" xmlns="http://www.w3.org/2000/svg"><path d="M14 21.435q3.079.0 5.257-2.178T21.435 14t-2.178-5.257T14 6.565 8.743 8.743 6.565 14t2.178 5.257T14 21.435zm9.933-3.311v5.809h-5.809L14 27.999l-4.124-4.066H4.067v-5.809L.001 14l4.066-4.124V4.067h5.809L14 .001l4.124 4.066h5.809v5.809L27.999 14z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_check" xmlns="http://www.w3.org/2000/svg"><path d="M8.885 20.197 25.759 3.323l2.24 2.24L8.885 24.677.0 15.792l2.24-2.24z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_check_circle_outline" xmlns="http://www.w3.org/2000/svg"><path d="M14 25.239q4.601.0 7.92-3.319T25.239 14 21.92 6.08 14 2.761 6.08 6.08 2.761 14t3.319 7.92T14 25.239zM14 0q5.784.0 9.892 4.108T28 14t-4.108 9.892T14 28t-9.892-4.108T0 14t4.108-9.892T14 0zm6.441 7.822 1.972 1.972-11.239 11.239L4.207 14l1.972-1.972 4.995 4.995z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_cloud_off" xmlns="http://www.w3.org/2000/svg"><path d="M9.023 10.5H7q-1.914.0-3.281 1.395t-1.367 3.309 1.367 3.281T7 19.852h11.375zM3.5 4.976l1.477-1.477L24.5 23.022l-1.477 1.477-2.352-2.297H6.999q-2.898.0-4.949-2.051t-2.051-4.949q0-2.844 1.969-4.867t4.758-2.133zm19.086 5.578q2.242.164 3.828 1.832T28 16.351q0 3.008-2.461 4.758l-1.695-1.695q1.805-.984 1.805-3.063.0-1.422-1.039-2.461t-2.461-1.039h-1.75v-.602q0-2.68-1.859-4.539t-4.539-1.859q-1.531.0-2.953.711l-1.75-1.695Q11.431 3.5 14.001 3.5q2.953.0 5.496 2.078t3.09 4.977z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_code" xmlns="http://www.w3.org/2000/svg"><path d="M9.917 24.5a1.75 1.75.0 10-3.501.001 1.75 1.75.0 003.501-.001zm0-21a1.75 1.75.0 10-3.501.001A1.75 1.75.0 009.917 3.5zm11.666 2.333a1.75 1.75.0 10-3.501.001 1.75 1.75.0 003.501-.001zm1.75.0a3.502 3.502.0 01-1.75 3.026c-.055 6.581-4.721 8.039-7.82 9.023-2.898.911-3.846 1.349-3.846 3.117v.474a3.502 3.502.0 011.75 3.026c0 1.932-1.568 3.5-3.5 3.5s-3.5-1.568-3.5-3.5c0-1.294.711-2.424 1.75-3.026V6.526A3.502 3.502.0 014.667 3.5c0-1.932 1.568-3.5 3.5-3.5s3.5 1.568 3.5 3.5a3.502 3.502.0 01-1.75 3.026v9.06c.93-.456 1.914-.766 2.807-1.039 3.391-1.075 5.323-1.878 5.359-5.687a3.502 3.502.0 01-1.75-3.026c0-1.932 1.568-3.5 3.5-3.5s3.5 1.568 3.5 3.5z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_copy" xmlns="http://www.w3.org/2000/svg"><path d="M23.502 25.438V7.626H9.562v17.812h13.94zm0-20.315q1.013.0 1.787.745t.774 1.757v17.812q0 1.013-.774 1.787t-1.787.774H9.562q-1.013.0-1.787-.774t-.774-1.787V7.625q0-1.013.774-1.757t1.787-.745h13.94zM19.689.0v2.562H4.438v17.812H1.936V2.562q0-1.013.745-1.787T4.438.001h15.251z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_dangerous" xmlns="http://www.w3.org/2000/svg"><path d="M21.802 19.833 15.969 14l5.833-5.833-1.969-1.969L14 12.031 8.167 6.198 6.198 8.167 12.031 14l-5.833 5.833 1.969 1.969L14 15.969l5.833 5.833zM19.833.0 28 8.167v11.666L19.833 28H8.167L0 19.833V8.167L8.167.0h11.666z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_date" xmlns="http://www.w3.org/2000/svg"><path d="M27.192 28.844V11.192H4.808v17.652h22.384zm0-25.689q1.277.0 2.253.976t.976 2.253v22.459q0 1.277-.976 2.216t-2.253.939H4.808q-1.352.0-2.291-.901t-.939-2.253V6.385q0-1.277.939-2.253t2.291-.976h1.577V.001h3.23v3.155h12.769V.001h3.23v3.155h1.577zm-3.155 11.267v3.155h-3.23v-3.155h3.23zm-6.46.0v3.155h-3.155v-3.155h3.155zm-6.384.0v3.155h-3.23v-3.155h3.23z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_download" xmlns="http://www.w3.org/2000/svg"><path d="M2.866 28.209h26.269v3.79H2.866v-3.79zm26.268-16.925L16 24.418 2.866 11.284h7.493V.001h11.283v11.283h7.493z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_email" xmlns="http://www.w3.org/2000/svg"><path d="M28.845 9.615v-3.23L16 14.422 3.155 6.385v3.23L16 17.577zm0-6.46q1.277.0 2.216.977T32 6.385v19.23q0 1.277-.939 2.253t-2.216.977H3.155q-1.277.0-2.216-.977T0 25.615V6.385q0-1.277.939-2.253t2.216-.977h25.69z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_error_outline" xmlns="http://www.w3.org/2000/svg"><path d="M14 25.239q4.601.0 7.92-3.319T25.239 14 21.92 6.08 14 2.761 6.08 6.08 2.761 14t3.319 7.92T14 25.239zM14 0q5.784.0 9.892 4.108T28 14t-4.108 9.892T14 28t-9.892-4.108T0 14t4.108-9.892T14 0zm-1.38 6.967h2.761v8.413H12.62V6.967zm0 11.239h2.761v2.826H12.62v-2.826z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_fire" xmlns="http://www.w3.org/2000/svg"><path d="M17.689 21.998q-.32.32-.8.576t-.864.384q-1.152.384-2.272.032t-1.888-.992q-.128-.128-.096-.256t.16-.192q1.216-.384 1.92-1.216t.96-1.792q.192-.896-.064-1.728t-.384-1.728q-.128-.704-.096-1.376t.288-1.312q0-.128.128-.128t.192.064q.384.832.992 1.472t1.28 1.216 1.216 1.248.672 1.568q.064.384.064.704.064.96-.32 1.92t-1.088 1.536zm3.84-10.944q-.768-.704-1.6-1.28t-1.6-1.344q-1.536-1.536-2.016-3.584t.16-4.16q.128-.32-.096-.544t-.544-.096q-.768.32-1.44.768t-1.312.896q-1.984 1.664-3.136 3.936T8.633 10.51t.8 5.088q0 .128.032.256t.032.256q0 .576-.512.832t-1.024-.192q-.128-.192-.192-.32-1.024-1.28-1.376-2.912t-.096-3.232q.064-.384-.288-.576t-.608.128q-1.28 1.664-1.856 3.68t-.448 4.064q0 .576.096 1.184t.288 1.184q.448 1.536 1.216 2.816 1.216 2.048 3.264 3.424t4.416 1.696q2.496.32 5.024-.256t4.448-2.304q1.408-1.344 2.208-3.104t.864-3.68-.704-3.712q-.064-.128-.096-.224t-.096-.224q-.576-1.088-1.28-1.984-.256-.384-.544-.704t-.672-.64z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_git" xmlns="http://www.w3.org/2000/svg"><path d="M27.472 12.753 15.247.529a1.803 1.803.0 00-2.55.0l-2.84 2.84 2.137 2.137a2.625 2.625.0 013.501 3.501l3.499 3.499a2.625 2.625.0 11-1.237 1.237l-3.499-3.499c-.083.04-.169.075-.257.106v7.3a2.626 2.626.0 11-1.75.0v-7.3a2.626 2.626.0 01-1.494-3.607L8.62 4.606l-8.09 8.09a1.805 1.805.0 000 2.551l12.225 12.224a1.803 1.803.0 002.55.0l12.168-12.168a1.805 1.805.0 000-2.551z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_github" xmlns="http://www.w3.org/2000/svg"><path d="M16 .394c8.833.0 15.999 7.166 15.999 15.999.0 7.062-4.583 13.062-10.937 15.187-.813.146-1.104-.354-1.104-.771.0-.521.021-2.25.021-4.396.0-1.5-.5-2.458-1.083-2.958 3.562-.396 7.312-1.75 7.312-7.896.0-1.75-.625-3.167-1.646-4.291.167-.417.708-2.042-.167-4.25-1.333-.417-4.396 1.646-4.396 1.646a15.032 15.032.0 00-8 0S8.937 6.602 7.603 7.018c-.875 2.208-.333 3.833-.167 4.25-1.021 1.125-1.646 2.542-1.646 4.291.0 6.125 3.729 7.5 7.291 7.896-.458.417-.875 1.125-1.021 2.146-.917.417-3.25 1.125-4.646-1.333-.875-1.521-2.458-1.646-2.458-1.646-1.562-.021-.104.979-.104.979 1.042.479 1.771 2.333 1.771 2.333.938 2.854 5.396 1.896 5.396 1.896.0 1.333.021 2.583.021 2.979.0.417-.292.917-1.104.771C4.582 29.455-.001 23.455-.001 16.393-.001 7.56 7.165.394 15.998.394zM6.063 23.372c.042-.083-.021-.187-.146-.25-.125-.042-.229-.021-.271.042-.042.083.021.187.146.25.104.062.229.042.271-.042zm.646.709c.083-.062.062-.208-.042-.333-.104-.104-.25-.146-.333-.062-.083.062-.062.208.042.333.104.104.25.146.333.062zm.625.937c.104-.083.104-.25.0-.396-.083-.146-.25-.208-.354-.125-.104.062-.104.229.0.375s.271.208.354.146zm.875.875c.083-.083.042-.271-.083-.396-.146-.146-.333-.167-.417-.062-.104.083-.062.271.083.396.146.146.333.167.417.062zm1.187.521c.042-.125-.083-.271-.271-.333-.167-.042-.354.021-.396.146s.083.271.271.312c.167.062.354.0.396-.125zm1.313.104c0-.146-.167-.25-.354-.229-.187.0-.333.104-.333.229.0.146.146.25.354.229.187.0.333-.104.333-.229zm1.208-.208c-.021-.125-.187-.208-.375-.187-.187.042-.312.167-.292.312.021.125.187.208.375.167s.312-.167.292-.292z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_gitlab" xmlns="http://www.w3.org/2000/svg"><path d="M1.629 11.034 14 26.888.442 17.048a1.09 1.09.0 01-.39-1.203l1.578-4.811zm7.217.0h10.309l-5.154 15.854zM5.753 1.475l3.093 9.559H1.63l3.093-9.559a.548.548.0 011.031.0zm20.618 9.559 1.578 4.811c.141.437-.016.922-.39 1.203l-13.558 9.84 12.371-15.854zm0 0h-7.216l3.093-9.559a.548.548.0 011.031.0z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_heart" xmlns="http://www.w3.org/2000/svg"><path d="M16 29.714a1.11 1.11.0 01-.786-.321L4.072 18.643c-.143-.125-4.071-3.714-4.071-8 0-5.232 3.196-8.357 8.535-8.357 3.125.0 6.053 2.464 7.464 3.857 1.411-1.393 4.339-3.857 7.464-3.857 5.339.0 8.535 3.125 8.535 8.357.0 4.286-3.928 7.875-4.089 8.035L16.785 29.392c-.214.214-.5.321-.786.321z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_home" xmlns="http://www.w3.org/2000/svg"><path d="M24.003 15.695v8.336c0 .608-.504 1.111-1.111 1.111h-6.669v-6.669h-4.446v6.669H5.108a1.119 1.119.0 01-1.111-1.111v-8.336c0-.035.017-.069.017-.104L14 7.359l9.986 8.232a.224.224.0 01.017.104zm3.873-1.198-1.077 1.285a.578.578.0 01-.365.191h-.052a.547.547.0 01-.365-.122L14 5.831 1.983 15.851a.594.594.0 01-.417.122.578.578.0 01-.365-.191L.124 14.497a.57.57.0 01.069-.781L12.679 3.314c.729-.608 1.91-.608 2.64.0l4.237 3.543V3.471c0-.313.243-.556.556-.556h3.334c.313.0.556.243.556.556v7.085l3.803 3.161c.226.191.26.556.069.781z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_info_outline" xmlns="http://www.w3.org/2000/svg"><path d="M12.62 9.793V6.967h2.761v2.826H12.62zM14 25.239q4.601.0 7.92-3.319T25.239 14 21.92 6.08 14 2.761 6.08 6.08 2.761 14t3.319 7.92T14 25.239zM14 0q5.784.0 9.892 4.108T28 14t-4.108 9.892T14 28t-9.892-4.108T0 14t4.108-9.892T14 0zm-1.38 21.033V12.62h2.761v8.413H12.62z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_keyboard_arrow_down" xmlns="http://www.w3.org/2000/svg"><path d="M3.281 5.36 14 16.079 24.719 5.36 28 8.641l-14 14-14-14z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_keyboard_arrow_left" xmlns="http://www.w3.org/2000/svg"><path d="M25.875 28.25 22.125 32 6.126 16.001 22.125.002l3.75 3.75-12.25 12.25z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_keyboard_arrow_right" xmlns="http://www.w3.org/2000/svg"><path d="M6.125 28.25 18.375 16 6.125 3.75 9.875.0l15.999 15.999L9.875 31.998z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_keyboard_arrow_up" xmlns="http://www.w3.org/2000/svg"><path d="M24.719 22.64 14 11.921 3.281 22.64.0 19.359l14-14 14 14z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_language" xmlns="http://www.w3.org/2000/svg"><path d="M20.112 16.826h4.732q.394-1.84.394-2.826t-.394-2.826h-4.732q.197 1.38.197 2.826t-.197 2.826zm-2.497 7.756q1.643-.526 3.418-2.005t2.695-2.991h-4.141q-.657 2.629-1.972 4.995zm-.329-7.756q.197-1.38.197-2.826t-.197-2.826h-6.573q-.197 1.38-.197 2.826t.197 2.826h6.573zM14 25.173q1.84-2.695 2.695-5.587h-5.39q.854 2.892 2.695 5.587zM8.413 8.413q.789-2.826 1.972-4.995-1.643.526-3.451 2.005T4.272 8.414h4.141zM4.272 19.587q.854 1.512 2.662 2.991t3.451 2.005q-1.315-2.366-1.972-4.995H4.272zm-1.117-2.761h4.732Q7.69 15.446 7.69 14t.197-2.826H3.155q-.394 1.84-.394 2.826t.394 2.826zM14 2.826q-1.84 2.695-2.695 5.587h5.39Q15.841 5.521 14 2.826zm9.727 5.587q-.92-1.512-2.695-2.991t-3.418-2.005q1.183 2.169 1.972 4.995h4.141zM14 0q5.784.0 9.892 4.108T28 14t-4.108 9.892T14 28t-9.892-4.108T0 14t4.108-9.892T14 0z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_link" xmlns="http://www.w3.org/2000/svg"><path d="M24.037 7.963q3.305.0 5.634 2.366T32 16t-2.329 5.671-5.634 2.366h-6.46v-3.08h6.46q2.028.0 3.493-1.465t1.465-3.493-1.465-3.493-3.493-1.465h-6.46v-3.08h6.46zM9.615 17.578v-3.155h12.77v3.155H9.615zM3.005 16q0 2.028 1.465 3.493t3.493 1.465h6.46v3.08h-6.46q-3.305.0-5.634-2.366T0 16.001t2.329-5.671 5.634-2.366h6.46v3.08h-6.46q-2.028.0-3.493 1.465t-1.465 3.493z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_menu" xmlns="http://www.w3.org/2000/svg"><path d="M.001 5.334h31.998v3.583H.001V5.334zm0 12.416v-3.5h31.998v3.5H.001zm0 8.916v-3.583h31.998v3.583H.001z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_notification" xmlns="http://www.w3.org/2000/svg"><path d="M22.615 19.384l2.894 2.894v1.413H2.49v-1.413l2.894-2.894V12.25q0-3.365 1.716-5.856t4.745-3.231v-1.01q0-.875.606-1.514T13.999.0t1.548.639.606 1.514v1.01q3.029.74 4.745 3.231t1.716 5.856v7.134zM14 27.999q-1.211.0-2.053-.808t-.841-2.019h5.788q0 1.144-.875 1.986T14 27.999z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_path" xmlns="http://www.w3.org/2000/svg"><path d="M28 12.62h-9.793V8.414h-2.826v11.173h2.826v-4.206H28V26.62h-9.793v-4.206H12.62v-14H9.794v4.206H.001V1.381h9.793v4.206h8.413V1.381H28V12.62z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_person" xmlns="http://www.w3.org/2000/svg"><path d="M16 20.023q5.052.0 10.526 2.199t5.473 5.754v4.023H0v-4.023q0-3.555 5.473-5.754t10.526-2.199zM16 16q-3.275.0-5.614-2.339T8.047 8.047t2.339-5.661T16 0t5.614 2.386 2.339 5.661-2.339 5.614T16 16z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_search" xmlns="http://www.w3.org/2000/svg"><path d="M11.925 20.161q3.432.0 5.834-2.402t2.402-5.834-2.402-5.834-5.834-2.402-5.834 2.402-2.402 5.834 2.402 5.834 5.834 2.402zm10.981.0L32 29.255 29.255 32l-9.094-9.094v-1.458l-.515-.515q-3.26 2.831-7.721 2.831-4.976.0-8.45-3.432T.001 11.925t3.474-8.45 8.45-3.474 8.407 3.474 3.432 8.45q0 1.802-.858 4.075t-1.973 3.646l.515.515h1.458z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_shield" xmlns="http://www.w3.org/2000/svg"><path d="M22.167 15.166V3.5h-8.166v20.726c.93-.492 2.424-1.349 3.883-2.497 1.95-1.531 4.284-3.919 4.284-6.562zm3.499-13.999v14c0 7.674-10.737 12.523-11.192 12.724-.146.073-.31.109-.474.109s-.328-.036-.474-.109c-.456-.201-11.192-5.049-11.192-12.724v-14C2.334.529 2.863.0 3.501.0H24.5c.638.0 1.167.529 1.167 1.167z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_star" xmlns="http://www.w3.org/2000/svg"><path d="M14 22.052 5.324 27.31l2.3-9.859L0 10.813l10.056-.854L14 .692l3.944 9.267L28 10.813l-7.624 6.638 2.3 9.859z"/></svg><svg viewBox="-7.27 -7.27 42.55 42.55" id="gdoc_tag" xmlns="http://www.w3.org/2000/svg"><path d="M17.52 17.52v-7.041h-7.041v7.041h7.041zM28 10.479h-7.041v7.041H28v3.439h-7.041V28H17.52v-7.041h-7.041V28H7.04v-7.041H-.001V17.52H7.04v-7.041H-.001V7.04H7.04V-.001h3.439V7.04h7.041V-.001h3.439V7.04H28v3.439z"/></svg><svg viewBox="-7.27 -7.27 46.55 46.55" id="gdoc_timer" xmlns="http://www.w3.org/2000/svg"><path d="M16 29q4.428.0 7.536-3.143t3.107-7.571-3.107-7.536T16 7.643 8.464 10.75t-3.107 7.536 3.107 7.571T16 29zM26.714 9.786q1.214 1.571 2.107 4.036t.893 4.464q0 5.643-4 9.678T16 32t-9.714-4.036-4-9.678 4-9.678T16 4.572q1.929.0 4.464.929t4.107 2.143l2.143-2.214q1.143.929 2.143 2.143zM14.5 19.857v-9.143h3v9.143h-3zM20.571.001v3.071h-9.143V.001h9.143z"/></svg></defs></svg><div class=wrapper><input type=checkbox class=hidden id=menu-control>
<input type=checkbox class=hidden id=menu-header-control><header class=gdoc-header><div class="container flex align-center justify-between"><label for=menu-control class=gdoc-nav__control tabindex=0><svg class="gdoc-icon gdoc_menu"><title>Open Navigation</title><use xlink:href="#gdoc_menu"/></svg><svg class="gdoc-icon gdoc_arrow_back"><title>Close Navigation</title><use xlink:href="#gdoc_arrow_back"/></svg></label><div><a class="gdoc-brand gdoc-header__link" href=https://FindNUS.github.io/><span class="flex align-center"><img class=gdoc-brand__img src=/logo.png alt>
<span class=gdoc-brand__title>FindNUS Documentation</span></span></a></div><div class=gdoc-menu-header><span class=gdoc-menu-header__items><span id=gdoc-color-theme><svg class="gdoc-icon gdoc_brightness_dark"><title>Toggle Dark/Light/Auto mode</title><use xlink:href="#gdoc_brightness_dark"/></svg><svg class="gdoc-icon gdoc_brightness_light"><title>Toggle Dark/Light/Auto mode</title><use xlink:href="#gdoc_brightness_light"/></svg><svg class="gdoc-icon gdoc_brightness_auto"><title>Toggle Dark/Light/Auto mode</title><use xlink:href="#gdoc_brightness_auto"/></svg></span><span class=gdoc-menu-header__home><a href=https://FindNUS.github.io/ class=gdoc-header__link><svg class="gdoc-icon gdoc_home"><title>Back to homepage</title><use xlink:href="#gdoc_home"/></svg></a></span><span class=gdoc-menu-header__control><label for=menu-header-control><svg class="gdoc-icon gdoc_keyboard_arrow_right"><use xlink:href="#gdoc_keyboard_arrow_right"/><title>Close Menu Bar</title></svg></label></span></span><label for=menu-header-control class=gdoc-menu-header__control><svg class="gdoc-icon gdoc_keyboard_arrow_left"><use xlink:href="#gdoc_keyboard_arrow_left"/><title>Open Menu Bar</title></svg></label></div></div></header><main class="container flex flex-even"><aside class=gdoc-nav><nav><div class="gdoc-search flex align-center"><svg class="gdoc-icon gdoc_search"><use xlink:href="#gdoc_search"/></svg><input type=text id=gdoc-search-input class=gdoc-search__input placeholder=Search aria-label=Search maxlength=64 data-site-base-url=https://FindNUS.github.io/ data-site-lang=en><div class="gdoc-search__spinner spinner hidden"></div><ul id=gdoc-search-results class=gdoc-search__list></ul></div><section class=gdoc-nav--main><h2>Navigation</h2><ul class=gdoc-nav__list><li><input type=checkbox class=hidden>
<label><span class=flex><a href=/problem/ class=gdoc-nav__entry>Problem Research</a></span></label></li><li><input type=checkbox class=hidden>
<label><span class=flex><a href=/scope/ class=gdoc-nav__entry>Project Scope</a></span></label></li><li><input type=checkbox class=hidden>
<label><span class=flex><a href=/userguide/ class=gdoc-nav__entry>User Guide</a></span></label></li><li><input type=checkbox class=hidden>
<label><span class=flex><a href=/devguide/ class=gdoc-nav__entry>Developer Guide</a></span></label></li><li><input type=checkbox class=hidden>
<label><span class=flex><a href=/technical/ class=gdoc-nav__entry>Technical Docs</a></span></label><ul class=gdoc-nav__list><li><input type=checkbox class=hidden>
<label><span class=flex><a href=/technical/challenges/ class=gdoc-nav__entry>Challenges</a></span></label></li><li><input type=checkbox class=hidden>
<label><span class=flex><a href=/technical/frontend/ class=gdoc-nav__entry>Frontend</a></span></label></li><li><input type=checkbox class=hidden>
<label><span class=flex><a href=/technical/backend/ class="gdoc-nav__entry is-active">Backend</a></span></label></li><li><input type=checkbox class=hidden>
<label><span class=flex><a href=/technical/usertesting/ class=gdoc-nav__entry>User Testing</a></span></label></li><li><input type=checkbox class=hidden>
<label><span class=flex><a href=/technical/unittesting/ class=gdoc-nav__entry>Unit Testing</a></span></label></li><li><input type=checkbox class=hidden>
<label><span class=flex><a href=/technical/swe/ class=gdoc-nav__entry>Software Engineering</a></span></label></li></ul></li><li><input type=checkbox class=hidden>
<label><span class=flex><a href=/ms1/ class=gdoc-nav__entry>Archive - Milestone 1</a></span></label></li><li><input type=checkbox class=hidden>
<label><span class=flex><a href=/ms2/ class=gdoc-nav__entry>Archive - Milestone 2</a></span></label></li></ul></section><section class=gdoc-nav--more></section></nav></aside><div class=gdoc-page><div class="gdoc-page__header flex flex-wrap
justify-end
hidden-mobile
hidden" itemprop=breadcrumb></div><article class="gdoc-markdown gdoc-markdown__align--left"><h1>Backend Technical Documentation</h1><div class=gdoc-page__anchorwrap><h2 id=table-of-contentstable-of-contents><a class=gdoc-markdown__link href=#table-of-contents>Table of contents</a>
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#table-of-contentstable-of-contents class="gdoc-page__anchor clip flex align-center" title="Anchor to: Table of contents" aria-label="Anchor to: Table of contents" href=#table-of-contentstable-of-contents><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><ul><li><a class=gdoc-markdown__link href=#key-technologies>Key Technologies</a></li><li><a class=gdoc-markdown__link href=#high-level-overview>High-Level Overview</a></li><li><a class=gdoc-markdown__link href=#integration-details>Integration Details</a><ul><li><a class=gdoc-markdown__link href=#recieving-http-requests-from-frontend>Recieving HTTP requests from frontend</a></li><li><a class=gdoc-markdown__link href=#sending-messages-between-microservices>Sending messages between microservices</a><ul><li><a class=gdoc-markdown__link href=#ensuring-thread-safe-communication>Ensuring Thread-safe communication</a></li></ul></li><li><a class=gdoc-markdown__link href=#creating-removing-and-updating-deleting-items>Creating, removing and updating, deleting Items</a><ul><li><a class=gdoc-markdown__link href=#image-storage-with-imgur>Image storage with Imgur</a></li><li><a class=gdoc-markdown__link href=#synchronising-the-search-engine>Synchronising the Search Engine</a></li></ul></li><li><a class=gdoc-markdown__link href=#smart-lookout-service-star>Smart Lookout Service ⭐</a><ul><li><a class=gdoc-markdown__link href=#examples>Examples</a></li></ul></li></ul></li><li><a class=gdoc-markdown__link href=#appendix-a-backend-design-choices>Appendix A: Backend Design Choices</a><ul><li><a class=gdoc-markdown__link href=#architecture-microservice>Architecture: Microservice</a></li><li><a class=gdoc-markdown__link href=#platform-heroku>Platform: Heroku</a><ul><li><a class=gdoc-markdown__link href=#additional-considerations>Additional Considerations</a></li></ul></li><li><a class=gdoc-markdown__link href=#database-mongodb>Database: MongoDB</a></li><li><a class=gdoc-markdown__link href=#message-broker-rabbitmq>Message Broker: RabbitMQ</a></li><li><a class=gdoc-markdown__link href=#search-engine-elasticsearch>Search Engine: Elasticsearch</a></li><li><a class=gdoc-markdown__link href=#language-golang>Language: Golang</a></li><li><a class=gdoc-markdown__link href=#image-storage-imgur>Image storage: Imgur</a></li></ul></li></ul><p>In this page, we document:</p><ol><li>The <strong>key technologies</strong> used</li><li>The <strong>high-level overview</strong> of the Backend</li><li>The <strong>integration</strong> details</li></ol><p>Specifically, this is a deep dive into how the various technologies are interfaced with each other.
<em>Why certain technologies?</em><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><div class=gdoc-page__anchorwrap><h1 id=key-technologies>Key Technologies
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#key-technologies class="gdoc-page__anchor clip flex align-center" title="Anchor to: Key Technologies" aria-label="Anchor to: Key Technologies" href=#key-technologies><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h1></div><p>This is a list of the technologies that we have used to build the backend.</p><ul><li>Golang (Language)</li><li><a class=gdoc-markdown__link href=https://github.com/gin-gonic/gin>Gin-gonic</a> (HTTP Router)</li><li>Docker (Runtime)</li><li>RabbitMQ (Message Broker)<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></li><li>Heroku (PaaS)</li><li>MongoDB (Database)</li><li>Bonsai ElasticSearch (Search Engine)</li><li>Firebase (Authentication)</li><li>Imgur (3rd Party API)</li><li>SMTP (Outlook Email Server)</li><li>Prose (Golang NLP library)</li></ul><div class=gdoc-page__anchorwrap><h1 id=high-level-overview>High-Level Overview
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#high-level-overview class="gdoc-page__anchor clip flex align-center" title="Anchor to: High-Level Overview" aria-label="Anchor to: High-Level Overview" href=#high-level-overview><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h1></div><p><img src=./backend.png alt="Backend Arch"></p><p>This figure shows how the backend roughly works as a whole unit to provide the backend API for FindNUS&rsquo; business logic.
As of Milestone 2, we deployed <strong>2 microservices</strong>, backend and item.</p><p>Backend is in charge of routing and item is in charge of CRUD.
The next section takes a closer look into <strong>HOW</strong> the technologies are integrated with each other.</p><div class=gdoc-page__anchorwrap><h1 id=integration-details>Integration Details
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#integration-details class="gdoc-page__anchor clip flex align-center" title="Anchor to: Integration Details" aria-label="Anchor to: Integration Details" href=#integration-details><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h1></div><p>This section dives deep into how the technology is integrated with one another to produce a cohesive backend.
We will explain the integration through <strong>events</strong>.</p><div class=gdoc-page__anchorwrap><h2 id=recieving-http-requests-from-frontend>Recieving HTTP requests from frontend
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#recieving-http-requests-from-frontend class="gdoc-page__anchor clip flex align-center" title="Anchor to: Recieving HTTP requests from frontend" aria-label="Anchor to: Recieving HTTP requests from frontend" href=#recieving-http-requests-from-frontend><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p><strong>Technologies Integrated (TI): Golang, Docker, Heroku</strong></p><p>The frontend needs things to be done, such as POSTing new items or GETting items from the database. This is done through the backend providing an API using the HTTP.</p><p>These requests enter Heroku&rsquo;s platform and are forwarded to our <strong>Backend</strong> microservice.
To actually use these requests, integration is needed between our Docker runtime and Heroku&rsquo;s platform.<br>Heroku sends HTTP requests through a <code>PORT</code> env variable. We just need to get the port details and we can plug it into our logic to process the http requests.</p><p>Snippet:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>	<span class=nx>port</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Getenv</span><span class=p>(</span><span class=s>&#34;PORT&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>port</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// App is running locally
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>port</span> <span class=p>=</span> <span class=s>&#34;8080&#34;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span></code></pre></div><p>Using Gin-gonic, we can create a HTTP router to listen to the http requests coming in via <code>PORT</code>. We can also ignore malicious/invalid requests by configuring the Cross-Origin settings.</p><p>Snippet:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>router</span> <span class=o>:=</span> <span class=nx>gin</span><span class=p>.</span><span class=nf>Default</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>router</span><span class=p>.</span><span class=nf>Use</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=nx>cors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>cors</span><span class=p>.</span><span class=nx>Config</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>AllowAllOrigins</span><span class=p>:</span>  <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>AllowHeaders</span><span class=p>:</span>     <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;Origin&#34;</span><span class=p>,</span> <span class=s>&#34;Authorization&#34;</span><span class=p>,</span> <span class=s>&#34;Content-Type&#34;</span><span class=p>,</span> <span class=s>&#34;Access-Control-Allow-Headers&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>			<span class=nx>AllowMethods</span><span class=p>:</span>     <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;GET&#34;</span><span class=p>,</span> <span class=s>&#34;POST&#34;</span><span class=p>,</span> <span class=s>&#34;PATCH&#34;</span><span class=p>,</span> <span class=s>&#34;PUT&#34;</span><span class=p>,</span> <span class=s>&#34;DELETE&#34;</span><span class=p>,</span> <span class=s>&#34;OPTIONS&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>			<span class=nx>AllowCredentials</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>}),</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// ...Additional logic, omitted for brevity
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Listen for HTTP requests
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>router</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=s>&#34;:&#34;</span> <span class=o>+</span> <span class=nx>port</span><span class=p>)</span>  
</span></span></code></pre></div><div class=gdoc-page__anchorwrap><h2 id=sending-messages-between-microservices>Sending messages between microservices
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#sending-messages-between-microservices class="gdoc-page__anchor clip flex align-center" title="Anchor to: Sending messages between microservices" aria-label="Anchor to: Sending messages between microservices" href=#sending-messages-between-microservices><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p><strong>TI: Golang, RabbitMQ</strong></p><p>In the microservices architecture, business logic is seperated into different runtimes/containers based on function.<br>We will need to pass information between these runtimes, for example, the <strong>Backend Microservice</strong> needing to get a item&rsquo;s detail from the <strong>Item Microservice</strong>.</p><p>The microservices are blocked from using HTTP communication between one another due to Heroku policy. So, instead of HTTP, we need to leverage on a message broker with its own communication protocol, <strong>RabbitMQ</strong> to coordinate messages between these microservices.</p><p>In summary, using RabbitMQ, we defined three <strong>queues</strong> to send our own messages.</p><p><strong>Item Queue <code>q_item</code></strong><br>Handles one-off messages that require no return response, such as POST and DELETE.</p><p><strong>Remote Proceedure Call (RPC)<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> Queue <code>q_get_req, q_get_resp, etc</code></strong><br>Handles messages that require a return response, such as GET and search queries.</p><p>The below image illustrates the communciation pipelines between the various microservices using RabbitMQ.</p><p><img src=./mq.png alt="Message Queue Overview"></p><div class=gdoc-page__anchorwrap><h3 id=ensuring-thread-safe-communication>Ensuring Thread-safe communication
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#ensuring-thread-safe-communication class="gdoc-page__anchor clip flex align-center" title="Anchor to: Ensuring Thread-safe communication" aria-label="Anchor to: Ensuring Thread-safe communication" href=#ensuring-thread-safe-communication><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h3></div><p>In particular, when integrating Golang with RabbitMQ to implement the RPC pattern, each RPC job needs to be given a <strong>unique</strong> <code>correlation_id</code> to identify which RPC call the request belongs to. This is not implemented by the golang driver provided. So we created our own thread-safe unique correlation_id generator.</p><p>Thread safety is needed via <code>sync.Mutex</code> as the HTTP requests are processed <strong>in-parallel</strong>, so there is a risk that multiple RPC subroutines may have the same correlation_id, which will cause bugs.</p><p>Further, we <strong>DO NOT</strong> use randomly generated numbers as there is no guarantee that the randomly generated numbers won&rsquo;t be the same for 2 concurrent RPCs that call the random generator.</p><p>Snippet:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// JobID Unique Job ID. Overflows are OK
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>JobId</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>mu</span> <span class=nx>sync</span><span class=p>.</span><span class=nx>Mutex</span>
</span></span><span class=line><span class=cl>	<span class=nx>id</span> <span class=kt>uint64</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>rpcJobId</span> <span class=nx>JobId</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Thread-safe jobId implementation
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>GetJobId</span><span class=p>()</span> <span class=kt>uint64</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Force one goroutine to access jobId at a time
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// To prevent a race condition
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>rpcJobId</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>rpcJobId</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>rpcJobId</span><span class=p>.</span><span class=nx>id</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>	<span class=nx>jobId</span> <span class=o>:=</span> <span class=nx>rpcJobId</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>jobId</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=gdoc-page__anchorwrap><h2 id=creating-removing-and-updating-deleting-items>Creating, removing and updating, deleting Items
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#creating-removing-and-updating-deleting-items class="gdoc-page__anchor clip flex align-center" title="Anchor to: Creating, removing and updating, deleting Items" aria-label="Anchor to: Creating, removing and updating, deleting Items" href=#creating-removing-and-updating-deleting-items><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p><strong>TI: MongoDB, Imgur, Elasticsearch</strong></p><p>There are many moving parts and integrations in the CRUD logic. So, a diagram explaining one of the processes, POSTing a new item:<br><img src=./post.png alt="POST overview"></p><p>Updating and deleting items follow a very similar control flow, but is omitted for now due to repetition.<br>The important integration details explained below:</p><div class=gdoc-page__anchorwrap><h3 id=image-storage-with-imgur>Image storage with Imgur
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#image-storage-with-imgur class="gdoc-page__anchor clip flex align-center" title="Anchor to: Image storage with Imgur" aria-label="Anchor to: Image storage with Imgur" href=#image-storage-with-imgur><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h3></div><p>When a new item is added with a raw base_64 string representing the user-submitted image, we store it on imgur. Imgur returns a deleteHash key for us to delete the image, as well as a link to the stored image. We store the hash and link on a Imgur reference database collection to manage our Imgur links.<br>For delete item operations, the deleteHash is obtained from the Imgur collection to properly dispose of our Imgur image.</p><div class=gdoc-page__anchorwrap><h3 id=synchronising-the-search-engine>Synchronising the Search Engine
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#synchronising-the-search-engine class="gdoc-page__anchor clip flex align-center" title="Anchor to: Synchronising the Search Engine" aria-label="Anchor to: Synchronising the Search Engine" href=#synchronising-the-search-engine><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h3></div><p>Elasticsearch runs its own database store in order to index it properly to provide powerful searching capabilities. This means that we need to sync information between MongoDB and Elasticsearch.</p><p>We have explored solutions such as industry-tested Logstash and open-source &lsquo;River&rsquo;, but they are either paid or are outdated for our version of Elasticsearch.</p><p><strong>So, we settled on writing the database synchronisation logic ourselves in order to fully interface MongoDB and ElasticSearch</strong>.</p><p>We wrote equivalent CRUD operations on Elasticsearch for their MongoDB counterpart. If an item needs to be Added/Updated/Removed from MongoDB, a parallel and equivalent operation will be done on Elasticsearch.</p><p>Snippet of a ElasticSearch Item Addition:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Handler for Adding Item
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>ElasticAddItem</span><span class=p>(</span><span class=nx>item</span> <span class=nx>ElasticItem</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Check for item existence first as a safety catch to avoid redundant (the bad kind) copies
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>if</span> <span class=nf>ElasticGetItem</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>Id</span><span class=p>)</span> <span class=o>!=</span> <span class=p>(</span><span class=nx>ElasticItem</span><span class=p>{})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Item already exists! This is likely an update. Delete it and re-add in.
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// Deletion rather than patching is done due to paywalled API
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Deleting&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nf>ElasticDeleteItem</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>Id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>res</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>EsClient</span><span class=p>.</span><span class=nf>Index</span><span class=p>().</span><span class=nf>Index</span><span class=p>(</span><span class=nx>IndexName</span><span class=p>).</span><span class=nf>BodyJson</span><span class=p>(</span><span class=nx>item</span><span class=p>).</span><span class=nf>Do</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Add item response:&#34;</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=gdoc-page__anchorwrap><h2 id=smart-lookout-service-star>Smart Lookout Service ⭐
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#smart-lookout-service-star class="gdoc-page__anchor clip flex align-center" title="Anchor to: Smart Lookout Service ⭐" aria-label="Anchor to: Smart Lookout Service ⭐" href=#smart-lookout-service-star><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>A &ldquo;<strong>Smart Lookout Service</strong>&rdquo; was added in Milestone 3 as an edge feature.<br><strong>TI: Prose, Elasticsearch, SMTP</strong></p><p>Its function is to help Losters look through the dozens of found items and intelligently find Found items that match the Loster&rsquo;s lost item.</p><p>It uses <strong>Natural Language Processing</strong> to convert a Lost Item into a text-searchable query before sending it to a specially tuned ElasticSearch query to find good matches for the Lost item. We are using <a class=gdoc-markdown__link--code href=https://github.com/jdkato/prose><code>prose</code></a>, a NLP library for <code>go</code>.</p><p>A Lost (and found) item&rsquo;s data structure looks like this on MongoDB:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Item</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Id</span>              <span class=nx>primitive</span><span class=p>.</span><span class=nx>ObjectID</span> 
</span></span><span class=line><span class=cl>	<span class=nx>Name</span>            <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Date</span>            <span class=nx>time</span><span class=p>.</span><span class=nx>Time</span>
</span></span><span class=line><span class=cl>	<span class=nx>Location</span>        <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Category</span>        <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Contact_method</span>  <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Contact_details</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Item_details</span>    <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Image_url</span>       <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>User_id</span>         <span class=kt>string</span> 
</span></span><span class=line><span class=cl>	<span class=nx>Lookout</span>         <span class=kt>bool</span>   
</span></span><span class=line><span class=cl><span class=p>}</span>	
</span></span></code></pre></div><p>But how do we use NLP on this schema?</p><p>First, we strip away all irrelevant terms that may dirty our search. So, irrelevant things like contact_details and user_id are removed.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Item</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Name</span>            <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Location</span>        <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Category</span>        <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Item_details</span>    <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>	
</span></span></code></pre></div><p>We then concatenate these fields into a long string, delimited by a fullstop &lsquo;.&rsquo; in order for the NLP tokenizer to recognise the different fields as different sentences.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>item</span> <span class=nx>Item</span> <span class=c1>// an item of struct Item we want to process
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>rawString</span> <span class=o>:=</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>ToUpper</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>Name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>rawString</span> <span class=o>+=</span> <span class=s>&#34;. &#34;</span> <span class=o>+</span> <span class=nx>item</span><span class=p>.</span><span class=nx>Category</span>
</span></span><span class=line><span class=cl><span class=nx>rawString</span> <span class=o>+=</span> <span class=s>&#34;. &#34;</span> <span class=o>+</span> <span class=nx>item</span><span class=p>.</span><span class=nx>Item_details</span>
</span></span><span class=line><span class=cl><span class=nx>rawString</span> <span class=o>+=</span> <span class=s>&#34;. &#34;</span> <span class=o>+</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>ToUpper</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>Location</span><span class=p>)</span> <span class=c1>// Force prose to recognise this as an entity
</span></span></span></code></pre></div><p>We then use <code>prose</code> and feed in our prepared string to process out the keywords. We use <code>prose</code> to identify important features of the string - entities (people, places), nouns and adjectives.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>doc</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>prose</span><span class=p>.</span><span class=nf>NewDocument</span><span class=p>(</span><span class=nx>rawString</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>query</span> <span class=o>:=</span> <span class=s>&#34;&#34;</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Entities hold more weight than descriptive tokens, so add them in as duplicates
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>ents</span> <span class=o>:=</span> <span class=nx>doc</span><span class=p>.</span><span class=nf>Entities</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>ent</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>ents</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>query</span> <span class=o>+=</span> <span class=s>&#34; &#34;</span> <span class=o>+</span> <span class=nx>ent</span><span class=p>.</span><span class=nx>Text</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>toks</span> <span class=o>:=</span> <span class=nx>doc</span><span class=p>.</span><span class=nf>Tokens</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Filter for keywords
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>tok</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>toks</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Take in all the nouns
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>if</span> <span class=nx>tok</span><span class=p>.</span><span class=nx>Tag</span> <span class=o>==</span> <span class=s>&#34;NN&#34;</span> <span class=o>||</span> <span class=nx>tok</span><span class=p>.</span><span class=nx>Tag</span> <span class=o>==</span> <span class=s>&#34;NNS&#34;</span> <span class=o>||</span> <span class=nx>tok</span><span class=p>.</span><span class=nx>Tag</span> <span class=o>==</span> <span class=s>&#34;NNPS&#34;</span> <span class=o>||</span> <span class=nx>tok</span><span class=p>.</span><span class=nx>Tag</span> <span class=o>==</span> <span class=s>&#34;NNP&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>query</span> <span class=o>+=</span> <span class=s>&#34; &#34;</span> <span class=o>+</span> <span class=nx>tok</span><span class=p>.</span><span class=nx>Text</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=nx>tok</span><span class=p>.</span><span class=nx>Tag</span> <span class=o>==</span> <span class=s>&#34;JJ&#34;</span> <span class=o>||</span> <span class=nx>tok</span><span class=p>.</span><span class=nx>Tag</span> <span class=o>==</span> <span class=s>&#34;JJR&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=c1>// As well as the adjectives
</span></span></span><span class=line><span class=cl><span class=c1></span>			<span class=nx>query</span> <span class=o>+=</span> <span class=s>&#34; &#34;</span> <span class=o>+</span> <span class=nx>tok</span><span class=p>.</span><span class=nx>Text</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span></code></pre></div><p>The keywords that we are interested in are <strong>Nouns</strong> of all forms and <strong>adjectives</strong>. This is because key identifiers for a Lost and Found item lie in nouns and adjectives.</p><div class=gdoc-page__anchorwrap><h3 id=examples>Examples
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#examples class="gdoc-page__anchor clip flex align-center" title="Anchor to: Examples" aria-label="Anchor to: Examples" href=#examples><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h3></div><p><strong>Input</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Name&#34;</span><span class=p>:</span> <span class=s2>&#34;Wireless Mouse&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;User_id&#34;</span><span class=p>:</span> <span class=s2>&#34;19fa21&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Date&#34;</span><span class=p>:</span> <span class=s2>&#34;2022-04-16T20:02:30Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Location&#34;</span><span class=p>:</span> <span class=s2>&#34;Central Library&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Category&#34;</span><span class=p>:</span> <span class=s2>&#34;Electronics&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Item_details&#34;</span><span class=p>:</span> <span class=s2>&#34;i found a logitech mouse at CLB level 2 in one of the cubicles.&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Output</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>WIRELESS MOUSE CLB WIRELESS MOUSE Electronics logitech mouse CLB level cubicles CENTRAL LIBRARY
</span></span></code></pre></div><p><strong>Input</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Name&#34;</span><span class=p>:</span> <span class=s2>&#34;Nalgene Water bottle&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;User_id&#34;</span><span class=p>:</span> <span class=s2>&#34;19fa21&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Date&#34;</span><span class=p>:</span> <span class=s2>&#34;2022-05-26T08:51:48.782Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Location&#34;</span><span class=p>:</span> <span class=s2>&#34;Digital Systems Lab&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Category&#34;</span><span class=p>:</span> <span class=s2>&#34;Bottles&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Image_url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://upload.wikimedia.org/wikipedia/commons/0/07/Multi-use_water_bottle.JPG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Item_details&#34;</span><span class=p>:</span> <span class=s2>&#34;I lost my nalgene bottle during peak hour at the lab. The bottle has a sticker on it and it&#39;s handle is broken&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Contact_details&#34;</span><span class=p>:</span> <span class=s2>&#34;@FindNUS&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Contact_method&#34;</span><span class=p>:</span> <span class=s2>&#34;Line&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><strong>Output</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>NALGENE WATER BOTTLE Bottles NALGENE WATER BOTTLE Bottles nalgene bottle peak hour lab bottle sticker handle DIGITAL SYSTEMS LAB
</span></span></code></pre></div><p>This processed text is important as it will give us <strong>relevant</strong> ElasticSearch results. When we ignore common filler words like <code>the</code>, <code>a</code>, <code>I</code>, we are sure that the ElasticSearch results are due to the keywords.</p><p>With the keyword string, we tune our ElasticSearch query to look for close matches.</p><p>We make use of <a class=gdoc-markdown__link--code href=https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-combined-fields-query.html#query-dsl-combined-fields-query><code>combined_fields</code></a> type of matching, where the query spans across multiple fields. Better matching items (more keyword hits) are given a higher score in the ElasticSearch algorithm.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-golang data-lang=golang><span class=line><span class=cl><span class=c1>// In the ElasticSearch database, the Item data structure is the same as the `Item` struct defined above.  
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>mmq</span> <span class=o>:=</span> <span class=nx>elastic</span><span class=p>.</span><span class=nf>NewMultiMatchQuery</span><span class=p>(</span>
</span></span><span class=line><span class=cl>		<span class=nx>qry</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;Name&#34;</span><span class=p>,</span> <span class=s>&#34;Location&#34;</span><span class=p>,</span> <span class=s>&#34;Item_details&#34;</span><span class=p>,</span> <span class=s>&#34;Category&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>mmq</span><span class=p>.</span><span class=nf>Type</span><span class=p>(</span><span class=s>&#34;combined_fields&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// Min match 3 clauses, 1 for category, 2 for others
</span></span></span><span class=line><span class=cl><span class=c1>// This filters out weakly matching items
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>mmq</span><span class=p>.</span><span class=nf>MinimumShouldMatch</span><span class=p>(</span><span class=s>&#34;3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>mmq</span><span class=p>.</span><span class=nf>FieldWithBoost</span><span class=p>(</span><span class=s>&#34;Name&#34;</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span> <span class=c1>// Name matches are more significant
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>mmq</span><span class=p>.</span><span class=nf>FieldWithBoost</span><span class=p>(</span><span class=s>&#34;Item_details&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span> <span class=c1>// Item_detail matches catch &#39;hidden&#39; significant keywords
</span></span></span></code></pre></div><p>With that, we are able to process Lost Items for their keywords and search for relevant matching Items.</p><p>This is integrated with the frontend. The frontend calls a <code>/lookout</code> endpoint which triggers our Lookout service and returns relevant matches to the user.<br><img src=similar.png alt="Lookout in action"></p><p>This automates the manual process of Losters having to scan through our website (or anywhere else) to search for suitable Found items matches.</p><p>As a <strong>bonus</strong>, we also allowed Users to subscribe to this &lsquo;Lookout&rsquo; service via <strong>email</strong>. This is the checkbox as shown in the image below:<br><img src=subscribe.png alt="Email lookout option"></p><div class=gdoc-page__anchorwrap><h1 id=appendix-a-backend-design-choices>Appendix A: Backend Design Choices
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#appendix-a-backend-design-choices class="gdoc-page__anchor clip flex align-center" title="Anchor to: Appendix A: Backend Design Choices" aria-label="Anchor to: Appendix A: Backend Design Choices" href=#appendix-a-backend-design-choices><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h1></div><p>The following was initially documented with references in Milestone 1. As it is important technical information, it is brought over here for documentation sake. <a class=gdoc-markdown__link href="https://drive.google.com/file/d/1X4n5IalejDChWyBY_rGtnBOd1qMa3wq_/view?usp=sharing">Link to the original document</a>.</p><div class=gdoc-page__anchorwrap><h2 id=architecture-microservice>Architecture: Microservice
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#architecture-microservice class="gdoc-page__anchor clip flex align-center" title="Anchor to: Architecture: Microservice" aria-label="Anchor to: Architecture: Microservice" href=#architecture-microservice><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>The backend’s overall function is to provide the front-facing web application a bunch of callable APIs. There are two general architectures to designing backend APIs6.
Monolithic – business logic & functionality are compiled to one large application.
Microservices – business logic & functions are factored out into logically grouped ‘services’ that are isolated from one another. They and communicate through communication protocols such as HTTP or remote procedure calls (RPC).</p><div class=table-wrap><table><thead><tr><th>Factor</th><th>Microservices</th><th>Monolith</th></tr></thead><tbody><tr><td>Speed of development</td><td>Needs more initial groundwork to setup the backend infrastructure</td><td>Scales very fast initially, but is harder to maintain the bigger the project</td></tr><tr><td>Coupling & Redundancy</td><td>Each microservice is loosely coupled: They work independently of one another, making it fault tolerant</td><td>Tightly coupled components: changing something may break the entire app</td></tr><tr><td>Flexibility</td><td>Each microservice can be built with completely different languages, dependencies and even tech stacks</td><td>Very difficult to change the tech stack the deeper the application is in development</td></tr><tr><td>Feature Scalability</td><td>Scales well in the long run due to loose coupling of components</td><td>Diminishing scaling speed due to tight coupling of components</td></tr><tr><td>Load Scalability</td><td>Scales horizontally – able to serve more consumers by simply launching more microservice nodes</td><td>Scales vertically, which is expensive and will cause downtime</td></tr><tr><td>Testing</td><td>Each microservice needs to be tested separately, with different scripts</td><td>End to end testing is easier as it only needs to be done on one application</td></tr></tbody></table></div><p>Ultimately, we chose to implement FindNUS using microservices architecture, primarily due to the factors highlighted in green. This is because:</p><ol><li><p>Loose coupling allows for redundancy. If some feature breaks, it will not take down the whole application with it. It also pinpoints us to the failing service for expedient debugging. This is important for Lost and Found services, which should be up 24/7 and cannot afford downtime.</p></li><li><p>Its high flexibility allows us to add various feature without breaking core functionality. For example, adding future features that require drastically different tech-stacks such as Machine-learning powered Lost-and-found matching (Python + TensorFlow) can be added with ease without breaking the core components already in place.</p></li><li><p>Its horizontal scalability allows us to scale FindNUS just-in-time based on real-time user load, minimising costs of running computational resources on Heroku and MongoDB.</p></li></ol><div class=gdoc-page__anchorwrap><h2 id=platform-heroku>Platform: Heroku
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#platform-heroku class="gdoc-page__anchor clip flex align-center" title="Anchor to: Platform: Heroku" aria-label="Anchor to: Platform: Heroku" href=#platform-heroku><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>To host our services, we needed something to host the backend code. We deliberated between cloud platform (s.a. Heroku, AWS), renting an actual server (s.a. Linode) and going serverless.</p><div class=table-wrap><table><thead><tr><th>Factor</th><th>Cloud/PaaS (Heroku)</th><th>Actual Server (Linode)</th><th>Serverless (Netlify, AWS Lambda)</th></tr></thead><tbody><tr><td>Load Scalability</td><td>Easily scalable with built-in load balancers</td><td>Need to manually handle load balancing and scaling by using tools such as Kubernetes</td><td>Easily scalable since the API triggers are handled by serverless calls</td></tr><tr><td>Uptime</td><td>Always on</td><td>Always on</td><td>Slower – tends to require more time due to cold start</td></tr><tr><td>Cost</td><td>Bounded to ‘free-tier’ limits</td><td>Most expensive: restrictive trial period</td><td>Bounded to number of API calls made (including testing).</td></tr><tr><td>Security</td><td>Abstracted away by cloud provider</td><td>Manual setup needed. Require a sysadmin’s expertise to fully secure it</td><td>Abstracted away by serverless provider</td></tr><tr><td>Testing</td><td>Comes with various free logging service and CICD tools built-in</td><td>Need to setup all testing tools manually</td><td>Few (free) tools for testing, logging and debugging available. Harder in nature due to reduced visibility of backend processes</td></tr></tbody></table></div><p>Ultimately, PaaS was chosen in favour of renting actual servers or going serverless. PaaS gives us the best middle ground. It provides flexibility to build FindNUS efficiently with high uptime and debugging visibility. Yet, have the more time-consuming and tedious backend groundwork such as security and load balancing abstracted away for us.</p><div class=table-wrap><table><thead><tr><th>Factor</th><th>Heroku</th><th>AWS</th><th>Firebase</th></tr></thead><tbody><tr><td>Cost</td><td>Free Forever</td><td>Most tools only have free trial for 1 year</td><td>Vast suite of free tools forever, excluding computational resources (Cloud Functions)</td></tr><tr><td>CPU Hours</td><td>1000/mo.</td><td>750/mo., 1-year free trial</td><td>N.A.</td></tr></tbody></table></div><p>Among the PaaS providers, Heroku wins out the traditional PaaS go-tos such as Firebase and AWS as it provides us the most CPU hours and is the lowest cost amongst them.</p><div class=gdoc-page__anchorwrap><h3 id=additional-considerations>Additional Considerations
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#additional-considerations class="gdoc-page__anchor clip flex align-center" title="Anchor to: Additional Considerations" aria-label="Anchor to: Additional Considerations" href=#additional-considerations><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h3></div><p><strong>Region Placement: Minimising latency</strong>. We had the choice between two regions for Heroku free-tier hosting, the EU and USA. We researched and realised that Heroku is hosted by AWS in Virginia (USA) and Ireland (EU)11. Based on an open cloud pinging service12, we determined that Heroku’s EU/Ireland region is the fastest (Annex D). Hence, we used the EU region and placed all other backend helper services (such as MongoDB Atlas) in the same region (EU/Ireland by AWS) in order to reduce latency between these components.</p><div class=gdoc-page__anchorwrap><h2 id=database-mongodb>Database: MongoDB
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#database-mongodb class="gdoc-page__anchor clip flex align-center" title="Anchor to: Database: MongoDB" aria-label="Anchor to: Database: MongoDB" href=#database-mongodb><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>MongoDB is a document-based database system. It stores data primarily via a key-value store. This was chosen in favour of traditional relational databases such as PostgreSQL due to the nature of the Lost and Found (LNF) process. LNF items can be potentially registered in a myriad of ways, from photos to NUS security to even voice recording.</p><p><strong>Flexible schema</strong>. MongoDB, being document-based, allows flexible scaling of object schema without breaking the whole table. We can phase in more LNF Item data properties as we scale features without breaking the entire table to allow voice recording, video bubble links, GeoJSON, “isWithNusSecurity” flags and more. This is not doable with SQL.</p><p><strong>Ease of use</strong>. There is no need for normalization13. This makes obtaining data easier since there is no need to join multiple tables from a normalized SQL database. Every parameter can be accessed straight from a document database.</p><p><strong>Schema: Optimising memory usage</strong>. As defined in Annex E, certain fields such as item category are stored as 32-bit integers rather than strings. Internally on the backend, there will be mapping logic converting the integers to and from their associated strings (s.a. 1 -> Cards, 2 -> Umbrella). This is done so to optimise each Item’s memory size. A 32-bit integer (4 bytes) holds less memory space compared to a string with at least 4 characters.</p><div class=gdoc-page__anchorwrap><h2 id=message-broker-rabbitmq>Message Broker: RabbitMQ
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#message-broker-rabbitmq class="gdoc-page__anchor clip flex align-center" title="Anchor to: Message Broker: RabbitMQ" aria-label="Anchor to: Message Broker: RabbitMQ" href=#message-broker-rabbitmq><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>Why do we need a message broker? For some context, in the Heroku environment, individual microservices are wrapped in containers called “Dynos”. These dynos are secured in the network and cannot communicate to one another14 over TCP. Hence, a communication protocol is required to pass information from one microservice container to the other for ‘work’ such as CRUD to be done.</p><p>We compared between three communication protocols that define how isolated containers can talk to each other: Remote procedure calls (RPC), REST and Message Queueing.</p><div class=table-wrap><table><thead><tr><th>Factor</th><th>RPC</th><th>REST</th><th>Message Queues (MQ)</th></tr></thead><tbody><tr><td>Heroku Support</td><td>Possible with RPC-enabling message brokers</td><td>Impossible, inter-container TCP communication is not allowed</td><td>Possible</td></tr><tr><td>Speed</td><td>Fastest</td><td>Slower than RPC</td><td>Slowest</td></tr><tr><td>Load Stability</td><td>Less stable</td><td>Stable</td><td>Stable</td></tr><tr><td>Message stability</td><td>Messages can get lost and is unrecoverable</td><td>Message loss is recoverable due to TCP handshake protocol</td><td>Messages are persistent and guaranteed to be delivered</td></tr></tbody></table></div><p>Since Heroku does not provide support for REST architecture for inter-container communication, we are forced to use RPC and Message Queuing, which is recommended by Heroku. To use RPC &/or MQ, we need a message broker. We chose CloudAMQP (RabbitMQ) as it has extensive documentation on integration with Heroku.</p><p>RabbitMQ is flexible – it allows us to use message queues and RPC. Rather than stick to one communication protocol, we plan to use both RPC and MQ as both protocols are best suited for certain use cases.</p><p><strong>RPC: Searching</strong>. RPC is very fast compared to the other protocols. This makes it suitable for short-lived operations that require quick responses, such as searching and autocompletion (Elasticsearch API calls). Even if the message is lost, it is tolerable in the case of autocompletion and just-in-time searching.</p><p><strong>MQ: Database CRUD</strong>. There are certain operations that need stability and data persistence. When submitting LNF requests/items, the end-user is likely to only POST the request once and leave the application. We cannot afford the situation where a user submits an item request/registration, but the message gets lost halfway in the backend and the item is not registered in the database. MQs can be configured to guarantee delivery and data persistence, this adds stability to the CRUD process which is critical to the Lost-and-found process.</p><div class=gdoc-page__anchorwrap><h2 id=search-engine-elasticsearch>Search Engine: Elasticsearch
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#search-engine-elasticsearch class="gdoc-page__anchor clip flex align-center" title="Anchor to: Search Engine: Elasticsearch" aria-label="Anchor to: Search Engine: Elasticsearch" href=#search-engine-elasticsearch><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>Elasticsearch (ES) was chosen as the search engine for our application due to the nature of our LNF item schema. Effective searches for lost items rely heavily on string-based parameters such as its name and item details. Further, the “Item_details” is effectively full text, where the users write a long description of the item which allows for flexibility in registering LNF items. For example, an item detail can be: “the bottle’s handle is broken, and it has a NUS sticker on it”.</p><p><strong>Full-text search</strong>. ES was built with text searching in mind23. It is optimised for indexing and searching through large bodies of text, such as the “Item_details” parameter. Although it is entirely possible to use full-text searches on SQL and even MongoDB, it is far simpler and to implement via ES. Most importantly, ES outperforms other competitors in querying speed.</p><div class=gdoc-page__anchorwrap><h2 id=language-golang>Language: Golang
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#language-golang class="gdoc-page__anchor clip flex align-center" title="Anchor to: Language: Golang" aria-label="Anchor to: Language: Golang" href=#language-golang><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>Golang is a widely used server-side language. Compared to other languages, we chose Golang for the following reasons:</p><ol><li>Golang is a relatively fast server-side language.</li><li>Easy to use HTTP server library that is concurrent by nature.
(<a class=gdoc-markdown__link href=https://github.com/gin-gonic/gin>https://github.com/gin-gonic/gin</a>)
Unit-testing is built into the language and is simple to make and run.</li></ol><div class=gdoc-page__anchorwrap><h2 id=image-storage-imgur>Image storage: Imgur
<a data-clipboard-text=https://FindNUS.github.io/technical/backend/#image-storage-imgur class="gdoc-page__anchor clip flex align-center" title="Anchor to: Image storage: Imgur" aria-label="Anchor to: Image storage: Imgur" href=#image-storage-imgur><svg class="gdoc-icon gdoc_link"><use xlink:href="#gdoc_link"/></svg></a></h2></div><p>Images tell a thousand words, which is why we included Images as part of the schema to submit a new item to the LNF database (Annex C). It is easier to identify lost items from pictures than wordy text. However, images take up a lot of space. To estimate storage requirements, we assumed that an average smartphone takes 12MP images which is about 3.6MB per photo. Our free-tier MongoDB has a storage limit of 512MB. If we only used it to store images, we can fit approximately 142 images, which is very small.</p><p>The above estimation discounts the fact that smartphone cameras are getting even more powerful, with the upper limit going as high as 108MP (approx. 30MB/photo). Even if we use lossy compression, the disk space required by photos will still be in the order of megabytes. Hence, we cannot afford to directly store images on our backend servers.</p><p>We decided to use Imgur as a 3rd party image hosting service to offload the storage needs for FindNUS. This is because it has a generous upload limit of 1250 images per day (52 images per hour) and image URL endpoints are persistent.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>In Milestone 1, we documented in-depth why we used certain technologies instead of another.
<a class=gdoc-markdown__link href="https://drive.google.com/file/d/1X4n5IalejDChWyBY_rGtnBOd1qMa3wq_/view?usp=sharing">Link to the document</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>A message broker is needed to communicate between docker containers. This is a heroku perculiarity as the docker containers cannot talk to each other via HTTP due to security policy. In industry, message brokers are often used to coordinate work as well.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>A RPC is something like a synchronous GET request. It enables two computers in seperate locations to send information to each other. <a class=gdoc-markdown__link href=https://www.geeksforgeeks.org/remote-procedure-call-rpc-in-operating-system/>A primer if you are interested</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article><div class="gdoc-page__footer flex flex-wrap justify-between"></div></div></main><footer class=gdoc-footer><nav class="container flex"><div><section class="flex flex-wrap align-center"><span class="gdoc-footer__item gdoc-footer__item--row">FindNUS, built with<svg class="gdoc-icon gdoc_heart"><use xlink:href="#gdoc_heart"/></svg> By <a href=https://github.com/jinxuan-owyong class=gdoc-footer__link>Jin Xuan</a> & <a href=https://github.com/nichyjt class=gdoc-footer__link>Nicholas</a></span></section></div><div class="flex flex-25 justify-end"><span class="gdoc-footer__item text-right"><a class="gdoc-footer__link fake-link" href=# aria-label="Back to top"><svg class="gdoc-icon gdoc_keyboard_arrow_up"><use xlink:href="#gdoc_keyboard_arrow_up"/></svg><span class=hidden-mobile>Back to top</span></a></span></div></nav></footer></div><script defer src=/js/search-1c4cfb2d.bundle.min.js></script></body></html>